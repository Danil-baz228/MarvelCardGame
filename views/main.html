<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Great Battle</title>
  <link rel="stylesheet" href="/main.css">
  <!-- {{USER_INJECT}} -->
</head>
<body>

<div id="intro-video-wrapper">
  <video id="intro-video" autoplay muted playsinline>
    <source src="/video/intro.mp4" type="video/mp4">
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥–µ–æ.
  </video>
</div>

<header class="site-header">
  <div class="header-inner">
    <h1 class="site-title">üÉè Great Battle</h1>
    <div id="auth-bar" class="auth-bar"></div>
  </div>
</header>

<main class="main-content">
  <section class="welcome-box fade-in">
    <h2>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ Marvel Card Game</h2>
    <p>–ë–∏—Ç–≤–∏ –≥–µ—Ä–æ—ó–≤ —ñ –ª–∏—Ö–æ–¥—ñ—ó–≤ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ —Ç—É—Ç!</p>
    <div id="action-section"></div>
  </section>

  <section class="rules-section fade-in">
    <h3>üìú –Ø–∫ –≥—Ä–∞—Ç–∏?</h3>
    <ul>
      <li>üîπ –£–≤—ñ–π–¥—ñ—Ç—å –∞–±–æ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å</li>
      <li>üîπ –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ì—Ä–∞—Ç–∏", —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ –±—ñ–π</li>
      <li>üîπ –ö–æ–∂–µ–Ω –≥—Ä–∞–≤–µ—Ü—å –æ—Ç—Ä–∏–º—É—î N –∫–∞—Ä—Ç</li>
      <li>üîπ –ì—Ä–∞ –π–¥–µ –ø–æ —á–µ—Ä–∑—ñ: –ê—Ç–∞–∫–∞, –ó–∞—Ö–∏—Å—Ç –∞–±–æ –ü–∞—Å</li>
      <li>üîπ –ü–µ—Ä–µ–º–∞–≥–∞—î —Ç–æ–π, —Ö—Ç–æ –ø–µ—Ä—à–∏–º –∑–Ω–∏–∑–∏—Ç—å HP —Å—É–ø–µ—Ä–Ω–∏–∫–∞ –¥–æ 0</li>
    </ul>
  </section>

  <section class="cards-preview fade-in">
    <h3>üÉè –ü—Ä–∏–∫–ª–∞–¥–∏ –∫–∞—Ä—Ç</h3>
    <div class="carousel">
      <button type="button" class="arrow left-arrow">‚¨Ö</button>
      <div class="card-container"></div>
      <button type="button" class="arrow right-arrow">‚û°</button>
    </div>
  </section>

  <section class="top-players-section fade-in">
    <h3>üèÜ –¢–æ–ø –≥—Ä–∞–≤—Ü—ñ–≤</h3>
    <table class="top-players-table">
      <thead>
      <tr>
        <th>–ú—ñ—Å—Ü–µ</th>
        <th>–ì—Ä–∞–≤–µ—Ü—å</th>
        <th>–ü–µ—Ä–µ–º–æ–≥–∏</th>
        <th>–†–µ–π—Ç–∏–Ω–≥</th>
      </tr>
      </thead>
      <tbody id="top-players-body">
      <tr><td colspan="4">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</td></tr>
      </tbody>
    </table>
  </section>

</main>

  <footer class="site-footer">
    <p>üîó –ó–≤ º—è–∑–æ–∫: <a href="https://t.me/Marshall949 ">@Marshall949, </a><a href="https://t.me/danilbaz">@danilbaz, </a><a href="https://t.me/MxmChb">@MxmChb</a> | GitHub: <a href="https://github.com/Danil-baz228/MarvelCardGame">MarvelCardGame</a></p>
  </footer>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const authBar = document.getElementById('auth-bar');
    const actionSection = document.getElementById('action-section');
    const videoWrapper = document.getElementById('intro-video-wrapper');
    const video = document.getElementById('intro-video');
    const skipBtn = document.getElementById('skip-intro');

    const versionKey = "introPlayedVersion";
    const currentVersion = "20240522_012";
    const lastSeenVersion = localStorage.getItem(versionKey);
    const shouldPlay = lastSeenVersion !== currentVersion;

    if (!shouldPlay) {
      videoWrapper.style.display = "none";
    } else {
      document.body.style.overflow = "hidden";

      video.addEventListener("ended", () => {
        videoWrapper.style.display = "none";
        document.body.style.overflow = "";
        localStorage.setItem(versionKey, currentVersion);
      });

      setTimeout(() => {
        if (videoWrapper.style.display !== "none") {
          videoWrapper.style.display = "none";
          document.body.style.overflow = "";
          localStorage.setItem(versionKey, currentVersion);
        }
      }, 30000);
    }

    if (window.user) {
      const avatarUrl = window.user.avatar_url || '/uploads/avatars/images.jpg';
      const avatar = `<img src="${avatarUrl}" class="avatar">`;

      authBar.innerHTML = `
        ${avatar}
        <span>–ü—Ä–∏–≤—ñ—Ç, <strong>${window.user.username}</strong></span>
        <a href="/profile" class="button">–ü—Ä–æ—Ñ—ñ–ª—å</a>
        <a href="/auth/logout" class="button">–í–∏–π—Ç–∏</a>
      `;
      actionSection.innerHTML = `<a href="/play" class="button play-button">üéÆ –ì—Ä–∞—Ç–∏</a>`;
    } else {
      authBar.innerHTML = `
        <a href="/auth/login" class="button">–£–≤—ñ–π—Ç–∏</a>
        <a href="/auth/register" class="button">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a>
      `;
      actionSection.innerHTML = `<p><strong>–£–≤—ñ–π–¥—ñ—Ç—å</strong>, —â–æ–± –ø–æ—á–∞—Ç–∏ –≥—Ä—É!</p>`;
    }

    let cardsData = [];

    const container = document.querySelector('.card-container');
    const leftArrow = document.querySelector('.left-arrow');
    const rightArrow = document.querySelector('.right-arrow');
    let currentIndex = 0;

    function renderCards() {
      const cardsToShow = cardsData.slice(currentIndex, currentIndex + 3);
      container.innerHTML = cardsToShow.map(card => `
    <div class="card">
      <img src="${card.img}" alt="${card.name}" loading="lazy">
      <p><strong>${card.name}</strong><br>üó° ${card.atk} ‚öî ${card.def} üí∞ ${card.cost}</p>
    </div>
  `).join('');
    }

    function changeCards(direction) {
      container.classList.add('fade-out');

      setTimeout(() => {
        currentIndex += direction * 3;

        if (currentIndex >= cardsData.length) currentIndex = 0;
        if (currentIndex < 0) currentIndex = cardsData.length - 3;

        renderCards();
        container.classList.remove('fade-out');
        container.classList.add('fade-in');

        setTimeout(() => {
          container.classList.remove('fade-in');
        }, 600);
      }, 300);
    }

    leftArrow.addEventListener('click', () => changeCards(-1));
    rightArrow.addEventListener('click', () => changeCards(1));

    fetch('/cards.json')
            .then(res => res.json())
            .then(data => {
              cardsData = data;
              renderCards();
            })
            .catch(err => {
              console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∏:', err);
              container.innerHTML = '<p>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç.</p>';
            });
  });

  const tbody = document.getElementById('top-players-body');

  if (window.topPlayers?.length) {
    tbody.innerHTML = window.topPlayers.map((p, index) => `
    <tr>
      <td>${index + 1}</td>
      <td>${p.username}</td>
      <td>${p.wins}</td>
      <td>${p.rating}</td>
    </tr>
  `).join('');
  } else {
    tbody.innerHTML = '<tr><td colspan="4">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</td></tr>';
  }

</script>


</body>
</html>
